---
version: "1.0.0"
last_updated: "2025-01-15"
status: "active"
owner: "Engineering Team"
category: "template"
---

# ポストモーテムテンプレート / Postmortem Template

## 📋 インシデント基本情報 / Incident Basic Information

### インシデントID / Incident ID
[例: INC-2025-001]

### インシデントタイトル / Incident Title
[簡潔で明確なタイトル]

### 発生日時 / Occurrence Date
- **検知日時**: YYYY-MM-DD HH:MM:SS (JST)
- **発生開始日時**: YYYY-MM-DD HH:MM:SS (JST)
- **復旧完了日時**: YYYY-MM-DD HH:MM:SS (JST)
- **総影響時間**: X時間Y分

### 重大度 / Severity
- [ ] Critical(致命的)- サービス完全停止
- [ ] High(高)- 主要機能に重大な影響
- [ ] Medium(中)- 一部機能に影響
- [ ] Low(低)- 軽微な影響

### 影響範囲 / Impact Scope
- [ ] 全ユーザー
- [ ] 特定ユーザーグループ
- [ ] 特定機能
- [ ] 内部システムのみ

### 作成者 / Author
- **氏名**: [名前]
- **役割**: [役職]
- **Email**: [メールアドレス]

### レビュアー / Reviewers
- [名前1] - [役職]
- [名前2] - [役職]

### 承認者 / Approver
- [名前] - [役職]

---

## 📊 エグゼクティブサマリー / Executive Summary

### 概要 / Overview
[インシデントの内容を3-5文で簡潔に説明。経営層や非技術者でも理解できる表現で記述]

### 主要なポイント / Key Points
- **何が起きたか**: [簡潔な説明]
- **影響**: [ビジネスへの影響]
- **根本原因**: [原因の要約]
- **対応策**: [実施した対策の要約]

### ビジネスインパクト / Business Impact
- **影響を受けたユーザー数**: [数値]
- **収益への影響**: [金額または割合]
- **顧客満足度への影響**: [評価]
- **ブランドイメージへの影響**: [評価]

---

## 📅 タイムライン / Timeline

### 詳細な時系列 / Detailed Timeline

| 時刻 (JST) | イベント | 担当者 | アクション |
|-----------|---------|--------|----------|
| 2025-01-15 10:00:00 | インシデント発生 | システム | [詳細] |
| 2025-01-15 10:05:00 | アラート検知 | 監視システム | CloudWatch アラート発火 |
| 2025-01-15 10:07:00 | 初動対応開始 | オンコールエンジニア | インシデント確認開始 |
| 2025-01-15 10:15:00 | エスカレーション | オンコールエンジニア | テックリードに連絡 |
| 2025-01-15 10:20:00 | 戦争室開設 | インシデントコマンダー | Zoom会議室開設 |
| 2025-01-15 10:30:00 | 原因特定 | インフラエンジニア | データベース接続プール枯渇を確認 |
| 2025-01-15 10:45:00 | 暫定対応実施 | インフラエンジニア | 接続プールサイズを緊急拡大 |
| 2025-01-15 11:00:00 | サービス復旧 | インシデントコマンダー | 正常動作確認 |
| 2025-01-15 11:30:00 | 監視強化 | SREチーム | 追加メトリクス設定 |
| 2025-01-15 12:00:00 | インシデントクローズ | インシデントコマンダー | 正式にクローズ宣言 |

### 検知から対応までの時間 / Detection to Response Time

```
検知までの時間: 5分
初動対応までの時間: 2分
原因特定までの時間: 23分
復旧までの時間: 1時間
```

---

## 🔍 何が起きたか / What Happened

### インシデントの詳細 / Incident Details

#### 症状 / Symptoms
[ユーザーや監視システムが観測した症状を詳細に記述]

**観測された現象**:
- API レスポンスタイムが通常の10倍(200ms → 2000ms)に増加
- エラー率が0.01%から15%に急増
- データベース接続エラーが多発
- ユーザーからの問い合わせが急増(通常の5倍)

**影響を受けたシステムコンポーネント**:
- API サーバー(全インスタンス)
- データベース接続プール
- ユーザー認証システム
- 決済処理システム

#### トリガー / Trigger
[インシデントのきっかけとなった直接的な要因]

新しいマーケティングキャンペーンの開始により、通常の3倍のトラフィックが発生。データベース接続プールの設定が不十分だったため、接続が枯渇した。

#### 根本原因 / Root Cause
[技術的な根本原因を詳細に説明]

**直接原因**:
- データベース接続プールのサイズが50に設定されていた
- アプリケーションサーバーが15インスタンス稼働
- 1インスタンスあたり平均4接続を保持
- ピーク時に60接続が必要となり、接続プールが枯渇

**根本原因**:
1. **設計上の問題**: 接続プールサイズがキャパシティプランニングで考慮されていなかった
2. **監視の不足**: 接続プール使用率の監視が未実装
3. **負荷テスト不足**: マーケティングキャンペーン前の負荷テストが不十分
4. **スケーリング設定**: オートスケーリングの閾値が適切でなかった

#### 影響 / Impact

**ユーザーへの影響**:
- 約10,000人のアクティブユーザーが影響を受けた
- 新規ユーザー登録が1時間停止
- 既存ユーザーのログインに遅延が発生
- 約50件の決済トランザクションが失敗

**ビジネスへの影響**:
- 推定損失: ¥500,000(機会損失含む)
- 顧客満足度スコア: 一時的に20ポイント低下
- SNSでの否定的な言及: 15件
- サポートチケット: 通常の5倍(50件)

**技術的影響**:
- データベースCPU使用率: 95%まで上昇
- アプリケーションサーバーメモリ使用率: 85%まで上昇
- エラーログ: 約5,000件のエラーが記録

---

## 🛠️ 対応内容 / Response Actions

### 即座に実施した対応 / Immediate Actions

#### 1. 検知と初動対応 / Detection and Initial Response
- **10:05**: CloudWatch アラートによる自動検知
- **10:07**: オンコールエンジニアがSlackで初動対応開始を宣言
- **10:10**: ステータスページに「調査中」を掲載

#### 2. 診断と原因特定 / Diagnosis and Root Cause Identification
- **10:15**: アプリケーションログの確認
- **10:20**: データベース接続状況の確認
- **10:25**: APMツールでのトレース分析
- **10:30**: 接続プール枯渇を特定

#### 3. 暫定対応 / Temporary Mitigation
```bash
# データベース接続プールサイズの緊急拡大
# before: max_connections = 50
# after: max_connections = 150

aws rds modify-db-instance \
  --db-instance-identifier prod-db \
  --max-allocated-storage 150 \
  --apply-immediately
```

#### 4. 復旧確認 / Recovery Verification
- **11:00**: メトリクスの正常化を確認
- **11:10**: エラー率が0.01%以下に回復
- **11:15**: レスポンスタイムが正常値に戻ることを確認
- **11:20**: ステータスページを「復旧」に更新

### 恒久対応 / Permanent Solutions

#### 実施済み / Completed

1. **データベース接続プール設定の最適化**
   - 実施日: 2025-01-15
   - 担当者: インフラチーム
   - 内容: 接続プール設定を見直し、適切なサイズに変更
   ```yaml
   # 新しい設定
   database:
     pool:
       min: 10
       max: 200
       idle_timeout: 60s
       max_lifetime: 3600s
   ```

2. **監視アラートの追加**
   - 実施日: 2025-01-16
   - 担当者: SREチーム
   - 内容:
     - データベース接続プール使用率の監視(閾値: 80%)
     - アプリケーション接続エラー率の監視(閾値: 1%)
     - API レスポンスタイムの監視(P95 > 500ms)

3. **ドキュメントの更新**
   - 実施日: 2025-01-17
   - 担当者: テクニカルライター
   - 内容: キャパシティプランニングガイドに接続プール設定を追加

#### 予定 / Planned

1. **負荷テストプロセスの改善**
   - 予定日: 2025-01-31
   - 担当者: QAチーム
   - 内容: 大規模キャンペーン前の負荷テスト実施を必須化

2. **オートスケーリング設定の見直し**
   - 予定日: 2025-02-15
   - 担当者: インフラチーム
   - 内容: トラフィック急増時の自動スケーリング改善

3. **キャパシティプランニングの実施**
   - 予定日: 2025-02-28
   - 担当者: アーキテクトチーム
   - 内容: 四半期ごとのキャパシティレビュー実施

---

## 📚 学んだこと / Lessons Learned

### うまくいったこと / What Went Well

1. **迅速な検知**
   - CloudWatch アラートが5分以内にインシデントを検知
   - 自動通知により即座にチームが対応を開始

2. **効果的なコミュニケーション**
   - Slack の専用チャンネルでリアルタイム情報共有
   - ステータスページでユーザーへの透明な情報提供
   - 戦争室(War Room)の迅速な開設

3. **明確な役割分担**
   - インシデントコマンダーが指揮を執行
   - 各メンバーが自分の役割を理解して行動
   - エスカレーションパスが明確

4. **詳細なログ記録**
   - すべてのアクションが時系列で記録された
   - ポストモーテム作成が容易になった

### 改善が必要なこと / What Needs Improvement

1. **事前の負荷テスト不足**
   - マーケティングキャンペーン前に十分な負荷テストを実施していなかった
   - 想定トラフィックの見積もりが不正確だった

2. **監視の不足**
   - データベース接続プール使用率の監視が未実装
   - 早期警告シグナルを見逃していた

3. **キャパシティプランニングの欠如**
   - 定期的なキャパシティレビューが実施されていなかった
   - システムの成長に合わせた設定更新がなされていなかった

4. **ドキュメントの不備**
   - データベース接続プール設定に関するガイドラインが不足
   - 新規メンバーへのオンボーディング資料が不十分

5. **コミュニケーション**
   - ユーザーへの初期通知が遅れた(20分後)
   - 復旧見込み時間の提示が不十分

### 驚いたこと / Surprises

1. トラフィック増加の予測が実際の3倍も低かった
2. データベース接続プールの枯渇がこれほど急速に発生するとは予想外だった
3. 復旧後も一部のユーザーでキャッシュの問題が残存した

### 幸運だったこと / Lucky Breaks

1. ピーク時間帯ではなく、比較的低トラフィックの時間帯だった
2. データベース自体には問題がなく、設定変更だけで復旧できた
3. 経験豊富なSREが即座に対応できた

---

## ✅ アクションアイテム / Action Items

### 優先度: Critical(緊急)

| # | アクション | 担当者 | 期限 | ステータス |
|---|----------|--------|------|----------|
| 1 | データベース接続プール設定の最適化 | インフラチーム | 2025-01-15 | ✅ 完了 |
| 2 | 接続プール使用率監視アラート追加 | SREチーム | 2025-01-16 | ✅ 完了 |
| 3 | インシデント対応手順書の更新 | テクニカルライター | 2025-01-20 | 🔄 進行中 |

### 優先度: High(高)

| # | アクション | 担当者 | 期限 | ステータス |
|---|----------|--------|------|----------|
| 4 | 負荷テストプロセスの改善 | QAチーム | 2025-01-31 | 📅 未着手 |
| 5 | キャンペーン前チェックリスト作成 | プロダクトチーム | 2025-01-31 | 📅 未着手 |
| 6 | オートスケーリング設定見直し | インフラチーム | 2025-02-15 | 📅 未着手 |

### 優先度: Medium(中)

| # | アクション | 担当者 | 期限 | ステータス |
|---|----------|--------|------|----------|
| 7 | キャパシティプランニングプロセス策定 | アーキテクトチーム | 2025-02-28 | 📅 未着手 |
| 8 | インシデント対応訓練実施 | SREチーム | 2025-02-28 | 📅 未着手 |
| 9 | ステータスページ自動更新機能追加 | 開発チーム | 2025-03-15 | 📅 未着手 |

### 優先度: Low(低)

| # | アクション | 担当者 | 期限 | ステータス |
|---|----------|--------|------|----------|
| 10 | ポストモーテムナレッジベース構築 | テクニカルライター | 2025-03-31 | 📅 未着手 |

---

## 🔗 関連情報 / Related Information

### 関連ドキュメント / Related Documents
- [インシデント報告書 INC-2025-001](link)
- [データベース接続プール設定ガイド](link)
- [負荷テスト実施手順](link)
- [インシデント対応マニュアル](link)

### 参考資料 / References
- [AWS RDS ベストプラクティス](https://docs.aws.amazon.com/rds/)
- [Connection Pooling Best Practices](https://example.com)

### メトリクスとグラフ / Metrics and Graphs
- [Datadog ダッシュボード](link)
- [CloudWatch メトリクス](link)
- [エラーログ分析](link)

### コミュニケーション履歴 / Communication History
- [Slack #incident-2025-001](link)
- [ステータスページ更新履歴](link)
- [顧客へのメール通知](link)

---

## 📞 ステークホルダーコミュニケーション / Stakeholder Communication

### 内部通知 / Internal Notifications

#### エンジニアリングチーム
- **方法**: Slack #incidents チャンネル
- **タイミング**: リアルタイム更新

#### 経営層
- **方法**: Email + Slack DM
- **タイミング**: インシデント検知後30分、復旧完了時

#### カスタマーサポート
- **方法**: 専用チャンネル + FAQ提供
- **タイミング**: インシデント確認後15分

### 外部通知 / External Notifications

#### ユーザー
- **方法**: ステータスページ、アプリ内通知
- **タイミング**: 検知後20分、復旧後
- **メッセージ例**:
  ```
  [障害情報] 2025年1月15日 10:00-11:00
  
  現在、一部のユーザー様において、サービスへのアクセスに
  遅延が発生しておりました。11:00に復旧いたしました。
  ご迷惑をおかけし、誠に申し訳ございませんでした。
  
  詳細: https://status.example.com/incidents/123
  ```

---

## 📝 承認 / Approval

| 役割 | 氏名 | 承認日 | 署名 |
|-----|------|--------|------|
| インシデントコマンダー | [名前] | YYYY-MM-DD | |
| テックリード | [名前] | YYYY-MM-DD | |
| SRE マネージャー | [名前] | YYYY-MM-DD | |
| CTO | [名前] | YYYY-MM-DD | |

---

## 🗓️ レビュー会議 / Review Meeting

### ポストモーテムレビュー会議 / Postmortem Review Meeting

- **日時**: 2025-01-18 14:00-15:30
- **場所**: Zoom / 会議室A
- **参加者**:
  - エンジニアリングチーム(全員)
  - プロダクトマネージャー
  - カスタマーサポート代表
  - 経営層(任意)

### アジェンダ / Agenda
1. インシデント概要の説明(10分)
2. タイムラインのウォークスルー(20分)
3. 根本原因の議論(20分)
4. 学んだことの共有(15分)
5. アクションアイテムの確認(15分)
6. Q&A(10分)

---

## 📎 添付資料 / Attachments

1. データベース接続プール使用率グラフ
2. エラーログサンプル
3. ユーザー影響分析レポート
4. 設定変更前後の比較

---

## 🎓 ナレッジベース登録 / Knowledge Base Entry

このポストモーテムの内容は以下のナレッジベースに登録されます:

- **カテゴリ**: データベース / パフォーマンス
- **タグ**: `database`, `connection-pool`, `performance`, `outage`
- **検索キーワード**: データベース接続, 接続プール枯渇, パフォーマンス劣化

---

## 📝 改訂履歴 / Revision History

| バージョン | 日付 | 変更内容 | 変更者 |
|----------|------|---------|--------|
| 1.0 | 2025-01-16 | 初版作成 | [名前] |
| 1.1 | 2025-01-17 | レビューコメント反映 | [名前] |
| 1.2 | 2025-01-18 | 最終承認版 | [名前] |
