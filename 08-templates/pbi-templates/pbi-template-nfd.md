# PBI: [機能名] - 新規機能開発

> **テンプレートタイプ**: NFD (New Feature Development)  
> **Phase経路**: 0→2→3→4→5（Phase 1スキップ）  
> **期間目安**: 1-2週間

---

## 📋 基本情報

| 項目 | 内容 |
|------|------|
| **PBIタイプ** | NFD - 新規機能開発 |
| **優先度** | [High / Medium / Low] |
| **Epic** | [該当するEpic名] |
| **作成日** | [YYYY-MM-DD] |
| **担当** | [担当者名またはチーム名] |

---

## ユーザーストーリー

**として**: [ユーザータイプ]  
**〜したい**: [やりたいこと]  
**なぜなら**: [理由・目的]

### 例
```
として: 買い物客
〜したい: 気になる商品をお気に入りに登録して後で見返したい
なぜなら: すぐに購入を決められない商品を記録しておき、比較検討したいから
```

---

## ビジネス価値

### 定量的目標
- **指標1**: [例: リピート率15%向上]
- **指標2**: [例: 平均購入単価10%向上]
- **指標3**: [例: ユーザーエンゲージメント20%向上]

### 対象ユーザー
- **ユーザー数**: [例: 月間2,000人想定]
- **ペルソナ**: [例: 20-40代、ECサイトのヘビーユーザー]

### ROI（投資対効果）
- **開発コスト**: [例: 40万円（5ポイント × 8万円/ポイント）]
- **期待リターン**: [例: 月間売上20万円増加]
- **投資回収期間**: [例: 2ヶ月]

---

## 受け入れ基準

### 機能要件
- [ ] 要件1: [例: 商品詳細画面に「お気に入り」ボタンが表示される]
- [ ] 要件2: [例: ボタンクリックでお気に入り追加/削除できる]
- [ ] 要件3: [例: マイページにお気に入り一覧が表示される]
- [ ] 要件4: [例: お気に入り商品が削除された場合、一覧から自動削除される]

### 非機能要件

#### パフォーマンス
- [ ] お気に入り追加/削除のレスポンスタイムが1秒以内
- [ ] お気に入り一覧の表示が2秒以内（50件表示時）

#### ユーザビリティ
- [ ] デスクトップ・タブレット・スマホで最適表示
- [ ] 楽観的UI（即座にフィードバック）
- [ ] キーボードのみで操作可能

#### セキュリティ
- [ ] 認証済みユーザーのみアクセス可能
- [ ] CSRFトークン実装
- [ ] レート制限: 100リクエスト/分/ユーザー

### テスト要件
- [ ] 単体テスト: カバレッジ80%以上
- [ ] 統合テスト: お気に入りCRUD操作
- [ ] E2Eテスト: ユーザーフロー全体
- [ ] パフォーマンステスト: 100同時ユーザー

### ドキュメント要件
- [ ] API仕様書更新（OpenAPI 3.0）
- [ ] README更新（機能説明追加）
- [ ] ユーザーマニュアル作成

---

## 技術的考慮事項

### データモデル変更
```sql
-- 新テーブル作成
CREATE TABLE favorites (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  product_id INTEGER NOT NULL REFERENCES products(id) ON DELETE CASCADE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(user_id, product_id)
);

CREATE INDEX idx_favorites_user_id ON favorites(user_id);
CREATE INDEX idx_favorites_product_id ON favorites(product_id);
```

### API設計
```
POST   /api/favorites          お気に入り追加
DELETE /api/favorites/:id      お気に入り削除
GET    /api/favorites          お気に入り一覧取得
GET    /api/products/:id       商品詳細（is_favorited追加）
```

### 既存システムへの影響
- **商品削除時**: 関連するお気に入りも削除（CASCADE設定）
- **商品APIの変更**: `is_favorited`フィールド追加（後方互換性あり）
- **パフォーマンス**: インデックス追加により既存クエリへの影響なし

### 使用技術
- **フロントエンド**: React, TypeScript, React Query
- **バックエンド**: Node.js, Express, Prisma
- **データベース**: PostgreSQL

---

## UI/UXモックアップ

### 商品詳細画面
```
[Figmaリンクまたは画像URL]

主な要素:
- お気に入りボタン（ハートアイコン）
- 未登録: 空のハートアイコン
- 登録済み: 塗りつぶしハートアイコン
- ホバー時: アニメーション
```

### お気に入り一覧画面
```
[Figmaリンクまたは画像URL]

主な要素:
- お気に入り商品カード（画像・名前・価格）
- 削除ボタン（各カード）
- ページネーション（20件/ページ）
- 空状態: 「お気に入りがありません」
```

---

## エッジケース・異常系

### エッジケース1: お気に入り上限
- **シナリオ**: ユーザーが100件登録済み
- **動作**: 追加時にエラーメッセージ表示
- **メッセージ**: 「お気に入りは100件までです。不要な商品を削除してください。」

### エッジケース2: 商品削除後
- **シナリオ**: お気に入り登録済み商品が削除される
- **動作**: お気に入り一覧から自動削除
- **通知**: 削除された商品があることを通知（オプション）

### 異常系1: 認証エラー
- **シナリオ**: 未ログインユーザーがお気に入り追加
- **動作**: 401エラー、ログイン画面へリダイレクト

### 異常系2: 存在しない商品
- **シナリオ**: 削除済み商品をお気に入り追加
- **動作**: 404エラー、エラーメッセージ表示

---

## 見積もり

| 項目 | 内容 |
|------|------|
| **ストーリーポイント** | [例: 5ポイント] |
| **期間** | [例: 3日] |
| **担当** | フロントエンド: [1名]、バックエンド: [1名] |

### 見積もり根拠
```
- データベーステーブル作成: 0.5日
- バックエンドAPI実装: 1日
- フロントエンドUI実装: 1日
- テスト作成: 0.5日
- ドキュメント更新: 0.5日
合計: 3.5日 → 5ポイント
```

---

## 関連PBI

- [ ] PBI-XXX: [関連する既存PBI]
- [ ] PBI-YYY: [次のスプリントで実装予定の関連機能]

---

## チェックリスト（提出前確認）

### 基本情報
- [ ] タイトルが明確
- [ ] PBIタイプが正しく設定（NFD）
- [ ] ユーザーストーリーが記載されている

### 内容の質
- [ ] ビジネス価値が定量的
- [ ] 受け入れ基準が具体的・測定可能
- [ ] 技術的考慮事項が明記されている
- [ ] UI/UXモックアップがある

### INVEST原則
- [ ] 独立性: 他のPBIから独立している
- [ ] 交渉可能性: 実装方法に柔軟性がある
- [ ] 価値: ステークホルダーに価値を提供
- [ ] 見積もり可能: チームが見積もり可能
- [ ] 小さい: 8ポイント以下
- [ ] テスト可能: 検証方法が明確

---

**テンプレートバージョン**: 1.0.0  
**最終更新日**: 2025-11-17
