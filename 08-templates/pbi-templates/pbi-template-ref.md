# PBI: [対象] - リファクタリング

> **テンプレートタイプ**: REF (Refactoring)  
> **Phase経路**: 0→3→4（Phase 2, 5スキップ）  
> **期間目安**: 1-5日

---

## 📋 基本情報

| 項目 | 内容 |
|------|------|
| **PBIタイプ** | REF - リファクタリング |
| **優先度** | [High / Medium / Low] |
| **作成日** | [YYYY-MM-DD] |
| **担当** | [担当者名] |

---

## リファクタリング対象

**ファイル/モジュール**: [例: src/services/UserService.ts]  
**現在の行数**: [例: 850行]  
**目標行数**: [例: 300行以下]

---

## 現在の問題

- [ ] 問題1: [例: 1つのクラスが850行と長大]
- [ ] 問題2: [例: createUserメソッドが200行（責務過多）]
- [ ] 問題3: [例: 重複コードが5箇所以上]
- [ ] 問題4: [例: Cyclomatic Complexity: 25（目標: 10以下）]

---

## 改善内容

### クラス分割
```
[Before]
UserService (850行)

[After]
UserService (150行) - 公開インターフェース
UserValidator (100行) - バリデーション
UserRepository (50行) - データアクセス
```

### メソッド分割
```typescript
// Before: 200行の巨大メソッド
async createUser(data) {
  // 全ての処理が1つのメソッドに
}

// After: 責務ごとに分割
async createUser(data) {
  await this.validator.validate(data);
  const user = await this.repository.create(data);
  await this.emailService.sendWelcome(user);
  return user;
}
```

---

## 受け入れ基準

### 機能要件（変更なし）
- [ ] 全ての既存テストが通る（[XX]件）
- [ ] E2Eテストが通る
- [ ] 機能・振る舞いが一切変わらない

### コード品質改善
- [ ] ファイル行数: [850行 → 300行以下]
- [ ] 最大メソッド行数: [200行 → 50行以下]
- [ ] Cyclomatic Complexity: [25 → 10以下]
- [ ] Code Duplication: [15% → 5%以下]
- [ ] テストカバレッジ: [60% → 80%以上]

---

## リスク管理

- **リスク**: リファクタリング中のバグ混入
- **軽減策**: 
  - 既存テストを全て維持・実行
  - 小さい単位で変更・コミット
  - コードレビューを必須化
- **ロールバック**: Git revertで即座に戻せる

---

## 見積もり

| 項目 | 内容 |
|------|------|
| **ストーリーポイント** | [例: 5ポイント] |
| **期間** | [例: 3日] |
| **担当** | [担当者名] |

---

## チェックリスト

- [ ] 機能変更がない
- [ ] 既存テストが全て通る
- [ ] コード品質メトリクスが改善
- [ ] リスク軽減策が明確

---

**テンプレートバージョン**: 1.0.0  
**最終更新日**: 2025-11-17
