name: PR Self-Review Reminder

on:
  pull_request:
    types: [opened]  # åˆå›æŠ•ç¨¿æ™‚ã®ã¿

jobs:
  remind-checklist:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check if Already Commented
        id: check_comment
        uses: actions/github-script@v7
        with:
          script: |
            const comments = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number
            });
            
            // æ—¢ã«ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚‹ã‹ç¢ºèª
            const hasReminder = comments.data.some(comment => 
              comment.user.type === 'Bot' && 
              comment.body.includes('ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’æ­£ã—ãé¸å®šã—ã€ç¢ºèªã—ã¦ã„ã¾ã™ã‹')
            );
            
            core.setOutput('already_commented', hasReminder);
            
            if (hasReminder) {
              console.log('â­ï¸  ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¯æ—¢ã«æŠ•ç¨¿æ¸ˆã¿ã§ã™');
            } else {
              console.log('âœ… ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’æŠ•ç¨¿ã—ã¾ã™');
            }
      
      - name: Post Checklist Reminder
        if: steps.check_comment.outputs.already_commented == 'false'
        uses: actions/github-script@v7
        with:
          script: |
            const reminder = `## ğŸ“‹ ã‚»ãƒ«ãƒ•ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼

@${context.payload.pull_request.user.login} ã•ã‚“

PRã‚’æŠ•ç¨¿ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼

**ãƒãƒ¼ã‚¸å‰ã«ã€çµ„ç¹”æ¨™æº–ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’æ­£ã—ãé¸å®šã—ã€ç¢ºèªã—ã¦ã„ã¾ã™ã‹ï¼Ÿ**

---

### ğŸ” ç¢ºèªæ‰‹é †

1. **é©åˆ‡ãªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’é¸å®šã—ã¦ãã ã•ã„**
   - å¤‰æ›´å†…å®¹ã«å¿œã˜ãŸé©åˆ‡ãªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ \`devin-organization-standards\` ã‹ã‚‰é¸ã‚“ã§ãã ã•ã„
   - è¤‡æ•°ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆãŒè©²å½“ã™ã‚‹å ´åˆã¯ã€ã™ã¹ã¦ç¢ºèªã—ã¦ãã ã•ã„

2. **ã‚»ãƒ«ãƒ•ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„**
   - é¸å®šã—ãŸãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã«æ²¿ã£ã¦ã€ã™ã¹ã¦ã®é …ç›®ã‚’ç¢ºèªã—ã¦ãã ã•ã„
   - ä¸æ˜ãªç‚¹ãŒã‚ã‚Œã°ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã™ã‚‹ã‹è³ªå•ã—ã¦ãã ã•ã„

3. **ç¢ºèªå®Œäº†ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ãã ã•ã„**
   - ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆç¢ºèªå®Œäº†å¾Œã€ã“ã®PRã«ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ãã ã•ã„
   - ã©ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ä½¿ç”¨ã—ãŸã‹æ˜è¨˜ã—ã¦ãã ã•ã„

---

### ğŸ“š å‚è€ƒè³‡æ–™

**çµ„ç¹”æ¨™æº–ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: \`/devin-organization-standards\`

ä¸»ãªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:
- [PRãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ](../devin-organization-standards/08-templates/pr-templates/PULL_REQUEST_TEMPLATE.md)
- [ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼åŸºæº–](../devin-organization-standards/03-development-process/code-review-standards.md)
- [ã‚³ãƒ¼ãƒ‰å“è³ªåŸºæº–](../devin-organization-standards/04-quality-standards/code-quality-standards.md)
- [ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„](../devin-organization-standards/01-coding-standards/)

---

### âš ï¸ é‡è¦

- ã“ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¯**åˆå›PRæŠ•ç¨¿æ™‚ã®ã¿**è¡¨ç¤ºã•ã‚Œã¾ã™
- é©åˆ‡ãªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®é¸å®šã¨ã‚»ãƒ«ãƒ•ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯**å¿…é ˆ**ã§ã™
- CIå“è³ªã‚²ãƒ¼ãƒˆãŒã™ã¹ã¦é€šéã™ã‚‹ã¾ã§ã€ã“ã®PRã¯ãƒãƒ¼ã‚¸ã§ãã¾ã›ã‚“

---

**AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ–¹ã¸**: 
ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å—ã‘å–ã£ãŸå ´åˆã¯ã€\`devin-organization-standards\` å†…ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã€
ã“ã®PRã®å¤‰æ›´å†…å®¹ã«é©ã—ãŸãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’é¸å®šã—ã¦ã‚»ãƒ«ãƒ•ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚
`;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: reminder
            });
            
            console.log('âœ… ã‚»ãƒ«ãƒ•ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’æŠ•ç¨¿ã—ã¾ã—ãŸ');
      
      - name: Add Label
        if: steps.check_comment.outputs.already_commented == 'false'
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels: ['needs-self-review']
            });
            
            console.log('ğŸ·ï¸  ãƒ©ãƒ™ãƒ« "needs-self-review" ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
