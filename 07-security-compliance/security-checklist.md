# セキュリティチェックリスト / Security Checklist

**最終更新日**: 2025-10-24  
**バージョン**: 1.0.0  
**対象**: 全開発者・QAエンジニア・セキュリティエンジニア・自律型AI Devin  

---

## 📖 目次

1. [設計フェーズチェックリスト](#1-設計フェーズチェックリスト)
2. [実装フェーズチェックリスト](#2-実装フェーズチェックリスト)
3. [テストフェーズチェックリスト](#3-テストフェーズチェックリスト)
4. [デプロイ前チェックリスト](#4-デプロイ前チェックリスト)
5. [OWASP Top 10 対策チェックリスト](#5-owasp-top-10-対策チェックリスト)
6. [コードレビューチェックリスト](#6-コードレビューチェックリスト)
7. [API セキュリティチェックリスト](#7-apiセキュリティチェックリスト)
8. [データベースセキュリティチェックリスト](#8-データベースセキュリティチェックリスト)
9. [フロントエンドセキュリティチェックリスト](#9-フロントエンドセキュリティチェックリスト)
10. [インフラセキュリティチェックリスト](#10-インフラセキュリティチェックリスト)

---

## 1. 設計フェーズチェックリスト

### 1.1 アーキテクチャセキュリティ

#### 認証・認可設計
- [ ] 認証方式を決定（JWT, OAuth 2.0, SAML等）
- [ ] 認可モデルを決定（RBAC, ABAC等）
- [ ] セッション管理方式を決定
- [ ] 多要素認証（MFA）の必要性を評価
- [ ] パスワードポリシーを定義

**参照**: `/07-security-compliance/authentication-authorization.md`

---

#### データ保護設計
- [ ] 個人情報の取り扱い範囲を明確化
- [ ] データ暗号化方式を決定（保存時、転送時）
- [ ] データマスキング要件を定義
- [ ] データバックアップ戦略を策定
- [ ] データ削除ポリシーを定義（論理削除 vs 物理削除）

**参照**: `/07-security-compliance/data-protection.md`

---

#### ネットワークセキュリティ設計
- [ ] HTTPS/TLS通信を必須化
- [ ] ファイアウォールルールを設計
- [ ] VPN要件を評価
- [ ] DDoS対策を計画
- [ ] セキュリティゾーニングを設計

---

### 1.2 脅威モデリング

#### リスク評価
- [ ] 想定される脅威を列挙（STRIDE分析）
- [ ] 資産の重要度を評価
- [ ] 攻撃シナリオを検討
- [ ] リスクレベルを評価（高/中/低）
- [ ] 対策の優先順位を決定

**STRIDEモデル**:
- **S**poofing（なりすまし）
- **T**ampering（改ざん）
- **R**epudiation（否認）
- **I**nformation Disclosure（情報漏洩）
- **D**enial of Service（サービス拒否）
- **E**levation of Privilege（権限昇格）

---

#### コンプライアンス要件
- [ ] GDPR適用の有無を確認
- [ ] 個人情報保護法の要件を確認
- [ ] 業界固有の規制を確認（金融、医療等）
- [ ] アクセシビリティ要件を確認（WCAG準拠）
- [ ] ライセンス要件を確認

**参照**: `/07-security-compliance/gdpr-compliance.md`

---

### 1.3 設計レビュー

- [ ] セキュリティアーキテクトによるレビュー完了
- [ ] 脅威モデリング結果を文書化
- [ ] セキュリティ設計書を作成
- [ ] チーム内でセキュリティ要件を共有

---

## 2. 実装フェーズチェックリスト

### 2.1 認証・認可実装

#### 認証実装
- [ ] パスワードを平文で保存していない（bcrypt/Argon2等でハッシュ化）
- [ ] JWTトークンを適切に検証（署名、有効期限、issuer等）
- [ ] リフレッシュトークンを安全に管理
- [ ] セッションタイムアウトを実装
- [ ] ログアウト機能を実装（トークン無効化）

```typescript
// ✅ 良い例：パスワードのハッシュ化
import bcrypt from 'bcrypt';

const saltRounds = 10;
const hashedPassword = await bcrypt.hash(password, saltRounds);

// ❌ 悪い例：平文で保存
const password = '123456'; // 絶対にやってはいけない
```

---

#### 認可実装
- [ ] すべての保護されたエンドポイントで認可チェック実施
- [ ] 最小権限の原則を適用
- [ ] ロール/権限を適切に管理
- [ ] 垂直権限昇格を防止（一般ユーザーが管理者機能にアクセス不可）
- [ ] 水平権限昇格を防止（他ユーザーのデータにアクセス不可）

```typescript
// ✅ 良い例：認可チェック
app.get('/users/:id', authenticate, async (req, res) => {
  if (req.user.id !== req.params.id && !req.user.isAdmin) {
    return res.status(403).json({ error: 'Forbidden' });
  }
  // 処理続行
});
```

---

### 2.2 入力検証とサニタイゼーション

#### 入力検証
- [ ] すべての入力に対してバリデーション実施
- [ ] ホワイトリスト方式で検証（ブラックリストは不完全）
- [ ] データ型、長さ、形式を検証
- [ ] ファイルアップロード時に拡張子とMIMEタイプを検証
- [ ] 入力サイズ制限を実装（DoS対策）

```typescript
// ✅ 良い例：厳格なバリデーション
import { z } from 'zod';

const userSchema = z.object({
  email: z.string().email().max(255),
  age: z.number().int().min(0).max(150),
  username: z.string().regex(/^[a-zA-Z0-9_]{3,20}$/)
});

// ❌ 悪い例：バリデーションなし
const user = req.body; // そのまま信頼してはいけない
```

---

#### サニタイゼーション
- [ ] HTMLをエスケープしてXSS対策
- [ ] SQLクエリをパラメータ化してSQLインジェクション対策
- [ ] コマンドインジェクション対策（外部コマンド実行を避ける）
- [ ] パストラバーサル対策（ファイルパスを検証）

```typescript
// ✅ 良い例：パラメータ化クエリ
const users = await db.query(
  'SELECT * FROM users WHERE email = $1',
  [email]
);

// ❌ 悪い例：文字列結合（SQLインジェクション脆弱性）
const users = await db.query(
  `SELECT * FROM users WHERE email = '${email}'`
);
```

---

### 2.3 データ保護実装

#### 暗号化
- [ ] 機密データを暗号化（AES-256等）
- [ ] HTTPS/TLSで通信を暗号化
- [ ] データベース接続を暗号化
- [ ] 暗号鍵を安全に管理（環境変数、Key Vault等）
- [ ] 暗号化アルゴリズムは最新の推奨を使用

```typescript
// ✅ 良い例：環境変数から鍵を取得
const secretKey = process.env.ENCRYPTION_KEY;
if (!secretKey) {
  throw new Error('Encryption key not configured');
}

// ❌ 悪い例：鍵をハードコード
const secretKey = 'my-secret-key-123'; // 絶対にやってはいけない
```

---

#### シークレット管理
- [ ] APIキー、パスワード等をコードにハードコードしていない
- [ ] 環境変数またはシークレット管理サービスを使用
- [ ] `.env`ファイルを`.gitignore`に追加
- [ ] ログにシークレットを出力していない
- [ ] エラーメッセージにシークレットを含めていない

---

### 2.4 エラーハンドリング

- [ ] 詳細なエラー情報をクライアントに返していない
- [ ] スタックトレースを本番環境で表示していない
- [ ] エラーを適切にログ記録（ただしシークレットは除外）
- [ ] ユーザーフレンドリーなエラーメッセージを表示
- [ ] 攻撃者に有用な情報を与えない

```typescript
// ✅ 良い例：安全なエラー処理
try {
  // 処理
} catch (error) {
  logger.error('Database error', { error }); // サーバー側でログ
  res.status(500).json({ error: 'Internal server error' }); // クライアントには最小限の情報
}

// ❌ 悪い例：詳細情報を返す
catch (error) {
  res.status(500).json({ error: error.message, stack: error.stack });
}
```

---

### 2.5 セキュアな設定

#### HTTPヘッダー
- [ ] `Content-Security-Policy`を設定
- [ ] `X-Content-Type-Options: nosniff`を設定
- [ ] `X-Frame-Options: DENY`または`SAMEORIGIN`を設定
- [ ] `Strict-Transport-Security`を設定（HSTS）
- [ ] `X-XSS-Protection: 1; mode=block`を設定

```typescript
// ✅ 良い例：セキュリティヘッダー設定
import helmet from 'helmet';
app.use(helmet());
```

---

#### CORS設定
- [ ] CORS設定を最小限に制限
- [ ] 信頼できるオリジンのみを許可
- [ ] `Access-Control-Allow-Credentials`の使用を慎重に検討
- [ ] ワイルドカード（*）の使用を避ける

```typescript
// ✅ 良い例：厳格なCORS設定
app.use(cors({
  origin: ['https://example.com'],
  credentials: true
}));

// ❌ 悪い例：すべて許可
app.use(cors({ origin: '*' }));
```

---

## 3. テストフェーズチェックリスト

### 3.1 セキュリティテスト

#### 自動テスト
- [ ] ユニットテストにセキュリティケースを含める
- [ ] 統合テストで認証・認可をテスト
- [ ] 入力検証のテストケースを作成
- [ ] エラーハンドリングのテストケースを作成

---

#### 脆弱性スキャン
- [ ] 静的アプリケーションセキュリティテスト（SAST）実施
- [ ] 動的アプリケーションセキュリティテスト（DAST）実施
- [ ] 依存ライブラリの脆弱性スキャン（npm audit, Snyk等）
- [ ] コンテナイメージのスキャン
- [ ] 発見された脆弱性を修正

**推奨ツール**:
- SAST: SonarQube, Checkmarx
- DAST: OWASP ZAP, Burp Suite
- 依存関係: npm audit, Snyk, Dependabot

---

#### 手動テスト
- [ ] 手動でOWASP Top 10を検証
- [ ] 権限昇格の試行
- [ ] セッション管理のテスト
- [ ] 入力検証のバイパス試行
- [ ] ファイルアップロード機能のテスト

---

### 3.2 ペネトレーションテスト（推奨）

- [ ] 外部のセキュリティ専門家によるペンテスト実施
- [ ] 発見された脆弱性を修正
- [ ] 修正後の再テスト実施
- [ ] ペンテスト結果を文書化

---

## 4. デプロイ前チェックリスト

### 4.1 本番環境設定

#### インフラセキュリティ
- [ ] ファイアウォールルール設定完了
- [ ] 不要なポートを閉鎖
- [ ] SSL/TLS証明書設定完了
- [ ] DDoS対策設定完了
- [ ] WAF（Web Application Firewall）設定（推奨）

---

#### アプリケーション設定
- [ ] デバッグモードを無効化
- [ ] 本番用のシークレット設定完了
- [ ] ログレベルを適切に設定
- [ ] エラーページをカスタマイズ（情報漏洩防止）
- [ ] 不要なエンドポイントを無効化

---

#### データベース設定
- [ ] データベースへの直接アクセスを制限
- [ ] データベースユーザーの権限を最小化
- [ ] データベース接続を暗号化
- [ ] バックアップ設定完了
- [ ] データベースパスワードを強力なものに設定

---

### 4.2 最終確認

#### ドキュメント
- [ ] セキュリティ設計書を更新
- [ ] インシデント対応手順書を準備
- [ ] 運用手順書にセキュリティ項目を記載
- [ ] 脆弱性報告窓口を設置

---

#### チーム準備
- [ ] チームメンバーにセキュリティ要件を共有
- [ ] インシデント対応担当者を決定
- [ ] 緊急連絡先を共有
- [ ] セキュリティ監視体制を確立

---

## 5. OWASP Top 10 対策チェックリスト

### A01:2021 – アクセス制御の不備

- [ ] すべての保護されたリソースで認可チェック実施
- [ ] デフォルトでアクセス拒否
- [ ] 最小権限の原則を適用
- [ ] 権限昇格の防止
- [ ] ダイレクトオブジェクト参照の検証

**対策例**:
```typescript
// ✅ 良い例：所有権チェック
app.delete('/posts/:id', authenticate, async (req, res) => {
  const post = await Post.findById(req.params.id);
  if (post.authorId !== req.user.id) {
    return res.status(403).json({ error: 'Forbidden' });
  }
  await post.delete();
});
```

---

### A02:2021 – 暗号化の失敗

- [ ] 機密データを暗号化（保存時、転送時）
- [ ] 強力な暗号化アルゴリズム使用（AES-256等）
- [ ] TLS 1.2以上を使用
- [ ] パスワードを適切にハッシュ化（bcrypt, Argon2）
- [ ] 暗号鍵を安全に管理

---

### A03:2021 – インジェクション

- [ ] パラメータ化クエリを使用（SQLインジェクション対策）
- [ ] ORMを使用してクエリを抽象化
- [ ] 入力をサニタイズ
- [ ] コマンドインジェクション対策
- [ ] LDAP、XML、OS注入対策

**対策例**:
```typescript
// ✅ SQLインジェクション対策
const result = await db.query('SELECT * FROM users WHERE id = $1', [userId]);

// ❌ 脆弱なコード
const result = await db.query(`SELECT * FROM users WHERE id = ${userId}`);
```

---

### A04:2021 – 安全でない設計

- [ ] 脅威モデリング実施
- [ ] セキュアなアーキテクチャパターン採用
- [ ] Defense in Depth（多層防御）実装
- [ ] フェイルセーフ設計
- [ ] セキュリティ要件を設計段階で定義

---

### A05:2021 – セキュリティの設定ミス

- [ ] デフォルトのアカウント/パスワードを変更
- [ ] 不要な機能を無効化
- [ ] セキュリティヘッダーを設定
- [ ] エラーメッセージで詳細情報を漏らさない
- [ ] 最新のセキュリティパッチを適用

---

### A06:2021 – 脆弱で古くなったコンポーネント

- [ ] 依存ライブラリを最新に保つ
- [ ] 脆弱性のある依存関係を修正
- [ ] 定期的に脆弱性スキャン実施
- [ ] 使用していないライブラリを削除
- [ ] ライブラリの更新を自動化（Dependabot等）

**コマンド例**:
```bash
# 脆弱性チェック
npm audit
npm audit fix

# または
yarn audit
```

---

### A07:2021 – 識別と認証の失敗

- [ ] 多要素認証（MFA）を実装
- [ ] 弱いパスワードを拒否
- [ ] アカウントロックアウト機能（ブルートフォース対策）
- [ ] セッションタイムアウト実装
- [ ] セッション固定攻撃対策

---

### A08:2021 – ソフトウェアとデータの整合性の不備

- [ ] コード署名を実装
- [ ] 依存関係の整合性を検証
- [ ] CI/CDパイプラインのセキュリティ確保
- [ ] 信頼できないソースからのデータを検証
- [ ] 自動更新の安全性を確保

---

### A09:2021 – セキュリティログとモニタリングの失敗

- [ ] 重要なイベントをログ記録
- [ ] ログを定期的に監視
- [ ] 異常なアクティビティを検知
- [ ] インシデント対応手順を準備
- [ ] ログを改ざんから保護

**ログすべきイベント**:
- ログイン試行（成功/失敗）
- 権限変更
- データ変更・削除
- セキュリティ例外
- システムエラー

---

### A10:2021 – サーバーサイドリクエストフォージェリ（SSRF）

- [ ] ユーザー入力をURLとして使用しない
- [ ] URLをホワイトリストで検証
- [ ] 内部IPアドレスへのアクセスをブロック
- [ ] リダイレクトを制限
- [ ] メタデータサービスへのアクセスを制限

---

## 6. コードレビューチェックリスト

### 6.1 認証・認可

- [ ] 認証が必要なエンドポイントで認証チェックが実装されているか
- [ ] 認可チェックが適切に実装されているか
- [ ] セッション管理は安全か
- [ ] トークンは適切に検証されているか

---

### 6.2 入力処理

- [ ] すべての入力にバリデーションがあるか
- [ ] サニタイゼーションが適切か
- [ ] ファイルアップロードは安全に処理されているか
- [ ] パストラバーサル対策があるか

---

### 6.3 データ保護

- [ ] 機密データは暗号化されているか
- [ ] シークレットがハードコードされていないか
- [ ] ログに機密情報が含まれていないか
- [ ] データベースクエリはパラメータ化されているか

---

### 6.4 エラーハンドリング

- [ ] エラーメッセージは適切か（情報漏洩なし）
- [ ] 例外処理は適切か
- [ ] エラーログは適切に記録されているか

---

### 6.5 設定

- [ ] セキュリティヘッダーは設定されているか
- [ ] CORS設定は適切か
- [ ] デバッグコードは削除されているか
- [ ] 本番環境で不要な機能は無効化されているか

---

## 7. APIセキュリティチェックリスト

### 7.1 認証・認可

- [ ] すべてのAPIエンドポイントで認証が必要（パブリックAPI除く）
- [ ] APIキーまたはトークンで認証
- [ ] レート制限を実装（DDoS/ブルートフォース対策）
- [ ] APIバージョニングを実装

---

### 7.2 入力検証

- [ ] リクエストボディを検証
- [ ] クエリパラメータを検証
- [ ] ヘッダーを検証
- [ ] Content-Typeを検証

---

### 7.3 レスポンス

- [ ] エラーレスポンスで詳細情報を漏らさない
- [ ] 適切なHTTPステータスコードを返す
- [ ] セキュリティヘッダーを含める
- [ ] レスポンスボディをサニタイズ

---

## 8. データベースセキュリティチェックリスト

- [ ] データベース接続を暗号化
- [ ] 最小権限のデータベースユーザーを使用
- [ ] パラメータ化クエリを使用
- [ ] ORMを適切に使用
- [ ] データベースパスワードを安全に管理
- [ ] 定期的にバックアップを実施
- [ ] バックアップを暗号化
- [ ] データベースへの直接アクセスを制限

---

## 9. フロントエンドセキュリティチェックリスト

### 9.1 XSS対策

- [ ] ユーザー入力をエスケープ
- [ ] `innerHTML`の使用を避ける
- [ ] Content Security Policy（CSP）を設定
- [ ] DOMベースXSS対策

---

### 9.2 CSRF対策

- [ ] CSRFトークンを実装
- [ ] SameSite Cookie属性を設定
- [ ] 重要な操作は再認証を要求

---

### 9.3 その他

- [ ] 機密情報をローカルストレージに保存しない
- [ ] トークンをセキュアに保存（HttpOnly Cookie推奨）
- [ ] HTTPSのみで通信
- [ ] サードパーティスクリプトを検証

---

## 10. インフラセキュリティチェックリスト

### 10.1 ネットワーク

- [ ] ファイアウォール設定完了
- [ ] VPN設定（必要な場合）
- [ ] DDoS対策実施
- [ ] 不要なポートを閉鎖

---

### 10.2 サーバー

- [ ] OSを最新に保つ
- [ ] 不要なサービスを停止
- [ ] SSH鍵認証を使用
- [ ] rootログインを無効化
- [ ] 定期的にセキュリティパッチを適用

---

### 10.3 コンテナ（Docker/Kubernetes）

- [ ] ベースイメージを最新に保つ
- [ ] コンテナイメージをスキャン
- [ ] 最小権限で実行
- [ ] シークレットを安全に管理（Kubernetes Secrets等）
- [ ] ネットワークポリシーを設定

---

## 📚 参考資料

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [OWASP Cheat Sheet Series](https://cheatsheetseries.owasp.org/)
- [CWE Top 25](https://cwe.mitre.org/top25/)

---

## 次のステップ

1. 該当するフェーズのチェックリストを実施
2. 発見された問題を記録
3. 優先順位をつけて修正
4. 修正後に再チェック
5. チーム内で結果を共有

---

**関連ドキュメント**:
- `/07-security-compliance/README.md` - セキュリティ標準概要
- `/07-security-compliance/secure-coding-practices.md` - セキュアコーディング詳細
- `/07-security-compliance/vulnerability-management.md` - 脆弱性管理
